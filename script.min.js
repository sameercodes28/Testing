(function(){'use strict';let projects=[];let focusableElements=[];let lastFocusedElement=null;let currentProject=null;let currentImageIndex=0;let translations={};let currentLanguage='sv';let visibleProjectsCount=0;const projectsToShowDesktop=9;const projectsToShowMobile=4;let projectsIncrement=0;const elements={projectsGrid:null,modal:null,modalTitle:null,modalImage:null,modalYear:null,modalTags:null,modalDescription:null,modalGallery:null,closeButton:null,navLinks:null};function init(){cacheElements();setupEventListeners();loadProjects();}function cacheElements(){elements.projectsGrid=document.getElementById('projects-grid');elements.modal=document.getElementById('project-modal');elements.modalTitle=document.getElementById('modal-title');elements.modalImage=document.getElementById('modal-image');elements.modalYear=document.getElementById('modal-year');elements.modalDescription=document.getElementById('modal-description');elements.modalGallery=document.getElementById('modal-gallery');elements.closeButton=document.querySelector('[data-close-modal]');elements.navLinks=document.querySelectorAll('.nav__link');elements.carouselImage=document.getElementById('carousel-image');elements.carouselDots=document.getElementById('carousel-dots');elements.carouselPrev=document.querySelector('.carousel-btn--prev');elements.carouselNext=document.querySelector('.carousel-btn--next');elements.backToTopBtn=document.getElementById('back-to-top-btn');elements.footer=document.querySelector('.footer');elements.cookieBanner=document.getElementById('cookie-consent-banner');elements.cookieAcceptBtn=document.getElementById('cookie-accept-btn');elements.languageToggle=document.getElementById('language-toggle');elements.loadMoreBtn=document.getElementById('load-more-btn');}function setupEventListeners(){setupNavigationScrolling();setupModalEventListeners();setupKeyboardNavigation();setupScrollSpyObserver();setupScrollAnimations();setupBackToTopButton();setupCookieConsent();setupLanguageSystem();setupLoadMoreButton();}function setupNavigationScrolling(){elements.navLinks.forEach(link=>{link.addEventListener('click',handleNavClick);});}function handleNavClick(event){event.preventDefault();const href=event.currentTarget.getAttribute('href');const targetId=href.substring(1);const targetElement=document.getElementById(targetId);if(targetElement){targetElement.scrollIntoView({behavior:'smooth',block:'start'});targetElement.focus({preventScroll:true});}}function setupModalEventListeners(){if(elements.closeButton){elements.closeButton.addEventListener('click',closeModal);}if(elements.modal){elements.modal.addEventListener('click',handleModalBackdropClick);}if(elements.carouselPrev){elements.carouselPrev.addEventListener('click',()=>navigateCarousel(-1));}if(elements.carouselNext){elements.carouselNext.addEventListener('click',()=>navigateCarousel(1));}if(elements.carouselDots){elements.carouselDots.addEventListener('click',handleDotClick);}}function setupKeyboardNavigation(){document.addEventListener('keydown',handleKeyDown);}function handleKeyDown(event){if(event.key==='Escape'&&elements.modal&&elements.modal.open){closeModal();return;}if(elements.modal&&elements.modal.open&&currentProject){if(event.key==='ArrowLeft'){event.preventDefault();navigateCarousel(-1);return;}if(event.key==='ArrowRight'){event.preventDefault();navigateCarousel(1);return;}}if(event.key==='Tab'&&elements.modal&&elements.modal.open){handleTabKeyInModal(event);}}function handleTabKeyInModal(event){if(focusableElements.length===0)return;const firstElement=focusableElements[0];const lastElement=focusableElements[focusableElements.length-1];if(event.shiftKey){if(document.activeElement===firstElement){lastElement.focus();event.preventDefault();}}else{if(document.activeElement===lastElement){firstElement.focus();event.preventDefault();}}}function isMobile(){return window.innerWidth<768;}async function loadTranslations(){try{const response=await fetch('ui-strings.json');if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}translations=await response.json();}catch(error){console.error('Error loading translations:',error);translations={};}}async function loadProjects(){try{showLoadingState();const response=await fetch('projects.json');if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}projects=await response.json();const initialCount=isMobile()?projectsToShowMobile:projectsToShowDesktop;projectsIncrement=isMobile()?projectsToShowMobile:projectsToShowDesktop;visibleProjectsCount=Math.min(initialCount,projects.length);renderProjects();updateLoadMoreButton();hideLoadingState();}catch(error){console.error('Error loading projects:',error);showErrorState();}}async function loadTranslations(){try{const response=await fetch('ui-strings.json');if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}translations=await response.json();}catch(error){console.error('Error loading translations:',error);translations={};}}function showLoadingState(){if(elements.projectsGrid){elements.projectsGrid.innerHTML=`<div class="loading-state" style="grid-column: 1 / -1; text-align: center; padding: 2rem;"><p style="color: var(--color-text-light);">Loading projects...</p></div>`;}}function showErrorState(){if(elements.projectsGrid){elements.projectsGrid.innerHTML=`<div class="error-state" style="grid-column: 1 / -1; text-align: center; padding: 2rem;"><p style="color: var(--color-text-light);">Unable to load projects. Please try again later.</p></div>`;}}function hideLoadingState(){const loadingState=document.querySelector('.loading-state');if(loadingState){loadingState.remove();}}function renderProjects(){if(!elements.projectsGrid||!projects.length)return;const projectsToShow=projects.slice(0,visibleProjectsCount);const projectsHTML=projectsToShow.map(project=>{const title=getLocalizedText(project.title);const altText=getLocalizedText(project.altText);return `<button type="button" class="project-card" data-project-id="${project.id}" aria-label="View details for ${title}"><img src="${project.mainImage}" alt="${altText}" class="project-card__image" loading="lazy" width="400" height="300"><h3 class="project-card__title">${escapeHtml(title)}</h3><p class="project-card__year">${escapeHtml(project.year)}</p></button>`;}).join('');elements.projectsGrid.innerHTML=projectsHTML;setupProjectCardListeners();}function appendProjects(){if(!elements.projectsGrid||!projects.length)return;const startIndex=Math.max(0,visibleProjectsCount-projectsIncrement);const endIndex=visibleProjectsCount;const newProjects=projects.slice(startIndex,endIndex);const projectsHTML=newProjects.map(project=>{const title=getLocalizedText(project.title);const altText=getLocalizedText(project.altText);return `<button type="button" class="project-card" data-project-id="${project.id}" aria-label="View details for ${title}"><img src="${project.mainImage}" alt="${altText}" class="project-card__image" loading="lazy" width="400" height="300"><h3 class="project-card__title">${escapeHtml(title)}</h3><p class="project-card__year">${escapeHtml(project.year)}</p></button>`;}).join('');elements.projectsGrid.insertAdjacentHTML('beforeend',projectsHTML);setupProjectCardListeners();}function setupProjectCardListeners(){if(elements.projectsGrid){elements.projectsGrid.removeEventListener('click',handleProjectGridClick);elements.projectsGrid.addEventListener('click',handleProjectGridClick);}}function handleProjectGridClick(event){const projectCard=event.target.closest('.project-card');if(projectCard){handleProjectCardClick({currentTarget:projectCard});}}function handleProjectCardClick(event){const projectId=event.currentTarget.getAttribute('data-project-id');const project=projects.find(p=>p.id===projectId);if(project){openModal(project);}}function openModal(project){if(!elements.modal)return;lastFocusedElement=document.activeElement;currentProject=project;currentImageIndex=0;populateModalContent(project);initializeCarousel(project);document.body.classList.add('modal-open');elements.modal.showModal();setupFocusTrapping();if(focusableElements.length>0){focusableElements[0].focus();}document.body.setAttribute('aria-hidden','true');elements.modal.removeAttribute('aria-hidden');document.body.style.overflow='hidden';}function populateModalContent(project){if(elements.modalTitle){elements.modalTitle.textContent=getLocalizedText(project.title);}if(elements.modalYear){elements.modalYear.textContent=project.year;}if(elements.modalDescription){elements.modalDescription.textContent=getLocalizedText(project.description);}}function setupFocusTrapping(){if(!elements.modal)return;const focusableSelectors=['button','[href]','input','select','textarea','[tabindex]:not([tabindex="-1"])'];focusableElements=elements.modal.querySelectorAll(focusableSelectors.join(','));focusableElements=Array.from(focusableElements).filter(el=>!el.disabled);}function closeModal(){if(!elements.modal)return;document.body.classList.remove('modal-open');elements.modal.close();currentProject=null;currentImageIndex=0;if(lastFocusedElement){lastFocusedElement.focus();lastFocusedElement=null;}document.body.removeAttribute('aria-hidden');elements.modal.setAttribute('aria-hidden','true');document.body.style.overflow='';focusableElements=[];}function handleModalBackdropClick(event){if(event.target===elements.modal){closeModal();}}function initializeCarousel(project){if(!project.gallery?.length)return;updateCarouselImage();generateCarouselDots(project.gallery.length);}function navigateCarousel(direction){if(!currentProject?.gallery?.length)return;const totalImages=currentProject.gallery.length;currentImageIndex=(currentImageIndex+direction+totalImages)%totalImages;updateCarouselImage();updateCarouselDots();}function updateCarouselImage(){if(!currentProject||!elements.carouselImage)return;const imageUrl=currentProject.gallery[currentImageIndex];const projectTitle=getLocalizedText(currentProject.title);const imageLabel=getTranslation('accessibility.imageAltPrefix')||'Image';elements.carouselImage.src=imageUrl;elements.carouselImage.alt=`${projectTitle} - ${imageLabel} ${currentImageIndex+1}`;}function generateCarouselDots(totalImages){if(!elements.carouselDots)return;const dotLabel=getTranslation('modal.dotButton')||'Go to image';const dotsHTML=Array.from({length:totalImages},(_, index)=>`<button class="carousel-dot ${index===0?'active-dot':''}" data-index="${index}" aria-label="${dotLabel} ${index+1}"></button>`).join('');elements.carouselDots.innerHTML=dotsHTML;}function updateCarouselDots(){if(!elements.carouselDots)return;const dots=elements.carouselDots.querySelectorAll('.carousel-dot');dots.forEach((dot,index)=>{if(index===currentImageIndex){dot.classList.add('active-dot');}else{dot.classList.remove('active-dot');}});}function handleDotClick(event){if(event.target.classList.contains('carousel-dot')){const index=parseInt(event.target.getAttribute('data-index'),10);if(!isNaN(index)){currentImageIndex=index;updateCarouselImage();updateCarouselDots();}}}function escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML;}function isModernBrowser(){return !!(window.fetch&&window.Promise&&Array.from&&Object.assign);}function showBrowserFallback(){const fallbackMessage=document.createElement('div');fallbackMessage.innerHTML=`<div style="background: #f8f9fa; padding: 1rem; margin: 1rem; border-radius: 8px; text-align: center;"><p style="color: #666;">Your browser doesn't support some modern features. Please update your browser for the best experience.</p></div>`;if(elements.projectsGrid){elements.projectsGrid.appendChild(fallbackMessage);}}function setupScrollSpyObserver(){const sections=document.querySelectorAll('section[id]');const navLinks=document.querySelectorAll('.nav__link');if(!sections.length||!navLinks.length)return;const observerOptions={root:null,rootMargin:'-20% 0px -70% 0px',threshold:0};const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){const sectionId=entry.target.id;navLinks.forEach(link=>{link.classList.remove('active-nav-link');});const activeLink=document.querySelector(`.nav__link[href="#${sectionId}"]`);if(activeLink){activeLink.classList.add('active-nav-link');}}});},observerOptions);sections.forEach(section=>{observer.observe(section);});}function setupScrollAnimations(){const animatedSections=document.querySelectorAll('section');if(!animatedSections.length)return;const observerOptions={root:null,rootMargin:'0px 0px -10% 0px',threshold:0.1};const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('is-visible');observer.unobserve(entry.target);}});},observerOptions);animatedSections.forEach(section=>{observer.observe(section);});}function setupBackToTopButton(){if(!elements.backToTopBtn||!elements.footer)return;const observerOptions={root:null,rootMargin:'0px',threshold:0.1};const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){elements.backToTopBtn.classList.add('is-visible');elements.backToTopBtn.classList.add('is-above-footer');}else{elements.backToTopBtn.classList.remove('is-visible');elements.backToTopBtn.classList.remove('is-above-footer');}});},observerOptions);observer.observe(elements.footer);elements.backToTopBtn.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'});});}function setupCookieConsent(){if(!elements.cookieBanner||!elements.cookieAcceptBtn)return;const consentCookie=getCookie('karin_cookie_consent');if(!consentCookie){setTimeout(()=>{elements.cookieBanner.classList.add('is-visible');},1000);}elements.cookieAcceptBtn.addEventListener('click',()=>{setCookie('karin_cookie_consent','true',365);elements.cookieBanner.classList.remove('is-visible');});}function getCookie(name){const value=`; ${document.cookie}`;const parts=value.split(`; ${name}=`);if(parts.length===2){return parts.pop().split(';').shift();}return null;}function setCookie(name,value,days){const expires=new Date();expires.setTime(expires.getTime()+(days*24*60*60*1000));document.cookie=`${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Lax`;}function getCurrentLanguage(){return localStorage.getItem('karin_language')||'sv';}function setLanguage(lang){currentLanguage=lang;localStorage.setItem('karin_language',lang);}function getLocalizedText(textObj){if(typeof textObj==='string')return textObj;if(typeof textObj==='object'&&textObj!==null){return textObj[currentLanguage]??textObj['en']??'';}return '';}function getTranslation(key){const keys=key.split('.');let value=translations;for(const k of keys){if(value&&typeof value==='object'){value=value[k];}else{return '';}}return getLocalizedText(value);}function renderPage(){const i18nElements=document.querySelectorAll('[data-i18n-key]');i18nElements.forEach(element=>{const key=element.getAttribute('data-i18n-key');const translatedText=getTranslation(key);if(translatedText){element.textContent=translatedText;}});const ariaElements=document.querySelectorAll('[data-i18n-aria]');ariaElements.forEach(element=>{const key=element.getAttribute('data-i18n-aria');const translatedText=getTranslation(key);if(translatedText){element.setAttribute('aria-label',translatedText);}});if(elements.languageToggle){const oppositeLanguage=currentLanguage==='sv'?'en':'sv';elements.languageToggle.textContent=oppositeLanguage.toUpperCase();}if(projects.length>0){renderProjects();updateLoadMoreButton();}if(currentProject&&elements.modal&&elements.modal.open){populateModalContent(currentProject);if(currentProject.gallery&&currentProject.gallery.length>0){updateCarouselImage();generateCarouselDots(currentProject.gallery.length);updateCarouselDots();}}}function setupLanguageSystem(){currentLanguage=getCurrentLanguage();if(elements.languageToggle){elements.languageToggle.addEventListener('click',()=>{const newLanguage=currentLanguage==='sv'?'en':'sv';setLanguage(newLanguage);renderPage();});}}function updateLoadMoreButton(){if(!elements.loadMoreBtn)return;if(visibleProjectsCount<projects.length){elements.loadMoreBtn.classList.add('is-visible');}else{elements.loadMoreBtn.classList.remove('is-visible');}}function setupLoadMoreButton(){if(!elements.loadMoreBtn)return;elements.loadMoreBtn.addEventListener('click',()=>{const remainingProjects=projects.length-visibleProjectsCount;const projectsToAdd=Math.min(projectsIncrement,remainingProjects);visibleProjectsCount+=projectsToAdd;appendProjects();updateLoadMoreButton();});}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',async function(){if(isModernBrowser()){await loadTranslations();init();renderPage();}else{showBrowserFallback();}});}else{if(isModernBrowser()){loadTranslations().then(()=>{init();renderPage();});}else{showBrowserFallback();}}})();